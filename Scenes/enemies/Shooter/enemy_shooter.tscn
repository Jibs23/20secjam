[gd_scene load_steps=12 format=3 uid="uid://7r7nsiw5c1sh"]

[ext_resource type="Script" uid="uid://dodb1uf4web4t" path="res://Scenes/enemies/Shooter/enemy_shooter.gd" id="1_b3xtc"]
[ext_resource type="Script" uid="uid://d3farf02gkq8e" path="res://Scripts/health.gd" id="3_4kvfp"]
[ext_resource type="Script" uid="uid://b3u4aiy6bgk1c" path="res://Scripts/Classes/finite_state_machine.gd" id="4_rp1hp"]
[ext_resource type="Script" uid="uid://bw6hejvpvmqbb" path="res://Scripts/states/pursuit.gd" id="5_e1uhq"]
[ext_resource type="Script" uid="uid://cbk4fxvsilclq" path="res://Scenes/enemies/Shooter/idle.gd" id="6_b3xtc"]
[ext_resource type="Script" uid="uid://sgyeob3hmfxb" path="res://Scripts/personal_space.gd" id="7_rrekk"]
[ext_resource type="Script" uid="uid://csrxxds2tne84" path="res://Scripts/debug_label.gd" id="8_3q1cy"]
[ext_resource type="Script" uid="uid://ct6f1rjjpxe0y" path="res://Scenes/enemies/Shooter/gun.gd" id="9_5sv12"]
[ext_resource type="PackedScene" uid="uid://63mcicmr7q4n" path="res://Scenes/enemies/Shooter/bullet.tscn" id="10_rdk6o"]

[sub_resource type="CircleShape2D" id="CircleShape2D_rdk6o"]
radius = 15.033297

[sub_resource type="CircleShape2D" id="CircleShape2D_w2043"]
radius = 63.03174

[node name="Enemy_shooter" type="RigidBody2D" node_paths=PackedStringArray("move_state", "health_component", "state_machine") groups=["enemy", "enemy_runner"]]
collision_layer = 4
collision_mask = 780
mass = 1.5
lock_rotation = true
contact_monitor = true
max_contacts_reported = 1
linear_damp = 3.0
script = ExtResource("1_b3xtc")
move_state = NodePath("StateMachine/move to position")
health_component = NodePath("HealthComponent")
state_machine = NodePath("StateMachine")
metadata/_custom_type_script = "uid://lp0wln500jpy"

[node name="Polygon2D2" type="Polygon2D" parent="."]
scale = Vector2(1.3636364, 1.3636364)
color = Color(0, 0.45, 0.19500002, 1)
polygon = PackedVector2Array(0, -11, -7, -7, -11, 0, -7, 7, 0, 8.8, 7, 7, 11, 0, 7, -7)

[node name="Polygon2D3" type="Polygon2D" parent="."]
position = Vector2(0, -1)
scale = Vector2(1.4545455, 1.4545455)
color = Color(0, 0.29374737, 0.2047185, 1)
polygon = PackedVector2Array(0, -10.3125, -4.125, -9.625, -7, -7, -9.625, -4.125, -11, 0, -9.625, 0.6875, -4.125, 1.375, 4.125, 1.375, 9.625, 0.6875, 11, 0, 9.625, -4.125, 7, -7, 4.125, -9.625)

[node name="CollisionShape2D" type="CollisionShape2D" parent="." groups=["player"]]
visible = false
shape = SubResource("CircleShape2D_rdk6o")

[node name="HealthComponent" type="Node" parent="." node_paths=PackedStringArray("shape_to_flash")]
script = ExtResource("3_4kvfp")
max_health = 1
shape_to_flash = NodePath("../CollisionShape2D")
metadata/_custom_type_script = "uid://d3farf02gkq8e"

[node name="StateMachine" type="Node" parent="." node_paths=PackedStringArray("initial_state", "actor") groups=["enemy_shooter"]]
script = ExtResource("4_rp1hp")
show_debug = false
initial_state = NodePath("move to position")
actor = NodePath("..")
metadata/_custom_type_script = "uid://b3u4aiy6bgk1c"

[node name="move to position" type="Node" parent="StateMachine" node_paths=PackedStringArray("state_idle")]
script = ExtResource("5_e1uhq")
idle_on_target_reached = true
state_idle = NodePath("../Idle")
metadata/_custom_type_script = "uid://55kpmp4krpql"

[node name="Idle" type="Node" parent="StateMachine" node_paths=PackedStringArray("move_state", "state_idle")]
script = ExtResource("6_b3xtc")
move_state = NodePath("../move to position")
state_idle = NodePath(".")
metadata/_custom_type_script = "uid://dkheav4fupoy2"

[node name="Personal Space" type="Area2D" parent="."]
visible = false
collision_mask = 4
script = ExtResource("7_rrekk")
valid_groups = Dictionary[String, int]({
"enemy": 0,
"enemy_flanker": 0,
"enemy_runner": 0,
"enemy_shield": 0,
"enemy_shooter": 1,
"player": 0
})

[node name="CollisionShape2D" type="CollisionShape2D" parent="Personal Space"]
shape = SubResource("CircleShape2D_w2043")
debug_color = Color(0.92681, 0.9257303, 1, 0.08235294)

[node name="Label" type="Label" parent="." node_paths=PackedStringArray("target_node")]
offset_left = -23.0
offset_top = -34.0
offset_right = 29.0
offset_bottom = -11.0
text = "HP"
script = ExtResource("8_3q1cy")
referenced_variable = "current_health"
target_node = NodePath("../HealthComponent")

[node name="GUN" type="Marker2D" parent="." node_paths=PackedStringArray("actor")]
script = ExtResource("9_5sv12")
bullet = ExtResource("10_rdk6o")
actor = NodePath("..")

[node name="Timer" type="Timer" parent="GUN"]
wait_time = 3.0
autostart = true

[node name="Polygon2D" type="Polygon2D" parent="GUN"]
color = Color(0.7021825, 0.75126517, 0.7721084, 1)
polygon = PackedVector2Array(15, -2, 36, -3, 36, -0.10458374, 36, 3, 15, 2, 11, 0)

[node name="Polygon2D" type="Polygon2D" parent="GUN/Polygon2D"]
color = Color(0, 0.056000013, 0.28, 0.5058824)
polygon = PackedVector2Array(36, -2, 34, -2, 33, 0, 34, 2, 36, 2)

[connection signal="body_entered" from="." to="." method="_on_body_entered"]
[connection signal="hit" from="." to="HealthComponent" method="_on_value_received"]
[connection signal="tree_entered" from="." to="." method="_on_tree_entered"]
[connection signal="health_empty" from="HealthComponent" to="." method="die"]
[connection signal="body_entered" from="Personal Space" to="Personal Space" method="_on_body_entered"]
[connection signal="body_exited" from="Personal Space" to="Personal Space" method="_on_body_exited"]
[connection signal="timeout" from="GUN/Timer" to="GUN" method="_on_timer_timeout"]
